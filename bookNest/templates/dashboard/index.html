{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Welcome to Your Dashboard</h2>

<!-- Link to Add a New Book -->
<a href="{{ url_for('books.add_book') }}" class="btn">Add a New Book</a>

<h3>Books</h3>
<!-- Sort by Genre -->
<form method="GET" action="{{ url_for('dashboard.index') }}">
    <label for="genre">Sort by Genre:</label>
    <select name="genre" id="genre">
        <option value="">All Genres</option>
        <option value="Fiction">Fiction</option>
        <option value="Non-Fiction">Non-Fiction</option>
        <option value="Sci-Fi">Sci-Fi</option>
        <option value="Fantasy">Fantasy</option>
        <option value="Mystery">Mystery</option>
        <option value="Dystopian">Dystopian</option>
        <option value="Romance">Romance</option>
        <option value="Young Adult">Young Adult</option>
        <option value="Horror">Horror</option>
    </select>
    <button type="submit">Sort</button>
</form>

<!-- Display all books -->
{% for book in books %}
    <div>
        <h3>
            <a href="{{ url_for('books.view_book', id=book.id) }}">{{ book.title }}</a>
        </h3>
        <p>Author: {{ book.author }}</p>
        <p>Genre: {{ book.genre }}</p>
        <p>Description: {{ book.description }}</p>
        <p>Average Rating: {{ book.avg_rating | round(1) }}</p>

        {% if g.user and book.user_id == g.user.id %}  <!-- Show buttons only if user is the owner -->
            <form action="{{ url_for('books.delete_book', id=book.id) }}" method="POST" style="display:inline;">
                <button type="submit">Delete</button>
            </form>
            <a href="{{ url_for('books.update_book', id=book.id) }}">Edit</a>
        {% endif %}
    </div>
    <hr>
{% endfor %}
{% endblock %}
